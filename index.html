<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TripMate ‚Äî Lifestyle Social Prototype (Vertical Feed)</title>
  <meta name="description" content="TripMate: ‡∏ü‡∏µ‡∏î‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô IG/Lemon8 + ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ + ‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÇ‡∏´‡∏ß‡∏ï + ‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏£‡∏¥‡∏õ + ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•/‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå + ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå + ‡∏™‡πà‡∏á‡∏ü‡∏µ‡∏î‡πÅ‡∏ö‡πá‡∏Å (Google Form)" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏Å‡∏≠‡∏£‡πå‡∏•‡∏ö‡∏≤‡∏£‡πå‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
    .no-scrollbar::-webkit-scrollbar{display:none}
    .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
    /* line clamp */
    .line-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    .line-3{display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden}
    /* Lemon8-like masonry: ‡πÉ‡∏ä‡πâ CSS columns + break-inside */
    .masonry { column-count: 2; column-gap: 0.75rem; }
    @media (min-width:640px){ .masonry { column-count: 3; } }
    @media (min-width:1024px){ .masonry { column-count: 4; } }
    .masonry-item { break-inside: avoid; margin-bottom: 0.75rem; }
    /* ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ò‡∏µ‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á */
    .theme-basic { background-image: linear-gradient(140deg,#f8fafc 0%,#ffffff 100%); }
    .theme-forest{ background-image: linear-gradient(140deg,#e8f5e9 0%,#e0f2f1 100%); }
    .theme-sunset{ background-image: linear-gradient(140deg,#fff1f2 0%,#fef3c7 100%); }
    .theme-night { background-image: linear-gradient(140deg,#0f172a 0%,#1f2937 100%); color:#e5e7eb; }
    /* ‡∏Å‡∏£‡∏≠‡∏ö‡∏≠‡∏ß‡∏≤‡∏ï‡∏≤‡∏£‡πå */
    .frame-none {}
    .frame-gold { box-shadow: 0 0 0 3px #f59e0b inset, 0 0 0 5px #fff; border-radius:999px; }
    .frame-neo  { box-shadow: 0 0 0 3px #06b6d4 inset, 0 0 0 5px #fff; border-radius:18px; }
    .frame-pastel { box-shadow: 0 0 0 3px #a78bfa inset, 0 0 0 5px #fff; border-radius:999px; }
    /* ‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏ö‡∏ô‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå */
    .sticker { position:absolute; transform: rotate(-10deg); }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">

  <!-- Top Bar -->
  <header class="sticky top-0 z-40 border-b bg-white/80 backdrop-blur">
    <div class="max-w-5xl mx-auto px-4 py-2 flex items-center gap-3">
      <div class="flex items-center gap-2 flex-1">
        <div class="w-9 h-9 rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-500 text-white grid place-items-center font-bold">T</div>
        <div class="font-extrabold tracking-tight">TripMate</div>
        <div class="hidden sm:flex items-center gap-2 ml-3 flex-1 max-w-md rounded-full px-3 py-1.5 border bg-white/60">
          <span>üîé</span>
          <input id="topSearch" class="bg-transparent outline-none text-sm w-full" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà ¬∑ ‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ¬∑ ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß" />
        </div>
      </div>
      <a href="https://forms.gle/JuJ2WWLeiRyTQSNU6" target="_blank" rel="noopener"
         class="border border-blue-600 text-blue-600 hover:bg-blue-600 hover:text-white transition rounded-full px-4 py-1.5 text-sm">
         ‡∏™‡πà‡∏á‡∏ü‡∏µ‡∏î‡πÅ‡∏ö‡πá‡∏Å
      </a>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-5xl mx-auto px-4 py-4 pb-28">
    <!-- DISCOVER -->
    <section id="page-discover" class="space-y-4">
      <div class="flex items-center justify-between">
        <div class="font-semibold">‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏∏‡∏ì (For you)</div>
        <div class="flex items-center gap-2">
          <button id="openCreatePost" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full px-4 py-2 text-sm">+ ‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</button>
          <button id="toggleView" class="border rounded-full px-3 py-2 text-sm">‡πÇ‡∏´‡∏°‡∏î: ‡∏†‡∏≤‡∏û‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á</button>
        </div>
      </div>

      <!-- ‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå/‡πÅ‡∏Æ‡∏ä‡πÅ‡∏ó‡πá‡∏Å -->
      <div id="promoBanners" class="flex gap-3 overflow-x-auto no-scrollbar"></div>
      <div id="topTags" class="flex gap-2 overflow-x-auto no-scrollbar"></div>

      <!-- ‡∏ü‡∏µ‡∏î: ‡πÇ‡∏´‡∏°‡∏î‡∏†‡∏≤‡∏û‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á (masonry) / ‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà (tiles) -->
      <div id="discoverMasonry" class="masonry"></div>
      <div id="discoverTiles" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </section>

    <!-- SEARCH -->
    <section id="page-search" class="hidden space-y-3">
      <div class="flex items-center gap-2">
        <div class="relative flex-1">
          <input id="searchInput" class="w-full border rounded-xl pl-9 pr-3 py-2 outline-none focus:ring-2 focus:ring-blue-500"
                 placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà ‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£...">
          <span class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">üîé</span>
        </div>
        <button id="applySearchBtn" class="border rounded-full px-3 py-2">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤üîé</button>
      </div>
      <div id="categoryChips" class="flex gap-2 overflow-x-auto no-scrollbar py-1"></div>
      <div id="provinceChips" class="flex gap-2 overflow-x-auto no-scrollbar py-1"></div>
      <div class="flex items-center gap-3 text-sm text-gray-600">
        <span>üß≠ ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î:</span> <span id="distVal">80</span> ‡∏Å‡∏°.
      </div>
      <input id="distSlider" type="range" min="5" max="200" step="5" value="80" class="w-full accent-blue-600" />
      <div id="locInfo" class="text-xs text-gray-500"></div>
      <div id="searchResults" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </section>

    <!-- GROUPS -->
    <section id="page-groups" class="hidden space-y-4">
      <div id="groupContainer"></div>
    </section>

    <!-- REWARDS -->
    <section id="page-rewards" class="hidden space-y-4">
      <div class="bg-white border rounded-2xl p-4 flex items-center justify-between">
        <div>
          <div class="text-lg font-semibold">‡πÅ‡∏ï‡πâ‡∏°‡∏™‡∏∞‡∏™‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</div>
          <div id="pointsEl" class="text-2xl font-bold text-blue-600">0 pts</div>
          <div id="badgesEl" class="mt-1 text-sm text-gray-500">‡πÅ‡∏ö‡∏î‡∏à‡πå: -</div>
        </div>
        <div class="text-4xl">üèÖ</div>
      </div>

      <div class="font-semibold">‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</div>
      <div id="rewardsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>

      <div class="font-semibold">‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡πÉ‡∏´‡∏°‡πà)</div>
      <div id="cosmeticsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3"></div>
    </section>

    <!-- PROFILE -->
    <section id="page-profile" class="hidden space-y-4">
      <div id="profileCard" class="relative bg-white border rounded-2xl overflow-hidden">
        <div id="profileTheme" class="h-24 theme-basic"></div>
        <div class="p-4 pt-0">
          <div class="relative -mt-8 flex items-center gap-3">
            <div id="avatarWrap" class="w-16 h-16 rounded-full bg-white grid place-items-center overflow-hidden frame-none">
              <img id="avatarImg" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?q=80&w=256&auto=format&fit=crop" class="w-full h-full object-cover"/>
            </div>
            <div class="min-w-0">
              <div class="text-xl font-semibold">
                <span id="userNameEl">‡πÅ‡∏ó‡∏°‡∏°‡∏µ‡πà</span>
                <span id="userHandleEl" class="text-sm text-gray-500">@tammy</span>
              </div>
              <div id="userMetaEl" class="text-sm text-gray-500">‡∏£‡∏∞‡∏î‡∏±‡∏ö: Explorer ¬∑ ‡πÅ‡∏ï‡πâ‡∏°: 0 ¬∑ ‡πÅ‡∏ö‡∏î‡∏à‡πå: -</div>
            </div>
          </div>
          <div id="profileStickers" class="relative h-0"></div>
          <div class="mt-3">
            <div class="font-semibold mb-2">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</div>
            <div id="myReviews" class="space-y-2"></div>
          </div>
        </div>
      </div>

      <!-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á -->
      <div class="bg-white border rounded-2xl p-4 space-y-3">
        <div class="font-semibold">‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</div>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-3" id="ownedCosmetics"></div>
      </div>
    </section>
  </main>

  <!-- Floating Create -->
  <button id="fabCreate" class="fixed bottom-20 right-5 bg-blue-600 hover:bg-blue-700 text-white rounded-full shadow-lg px-4 py-3 text-sm">
    + ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß
  </button>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-0 inset-x-0 bg-white border-t z-40">
    <div class="max-w-5xl mx-auto grid grid-cols-5 text-sm">
      <button data-tab="discover" class="py-3 flex flex-col items-center text-blue-600">üè†<span class="text-xs">‡∏ü‡∏µ‡∏î</span></button>
      <button data-tab="search" class="py-3 flex flex-col items-center text-gray-600">üîé<span class="text-xs">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</span></button>
      <button data-tab="groups" class="py-3 flex flex-col items-center text-gray-600">üë•<span class="text-xs">‡∏Å‡∏•‡∏∏‡πà‡∏°</span></button>
      <button data-tab="rewards" class="py-3 flex flex-col items-center text-gray-600">‚≠ê<span class="text-xs">‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</span></button>
      <button data-tab="profile" class="py-3 flex flex-col items-center text-gray-600">üë§<span class="text-xs">‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</span></button>
    </div>
  </nav>

  <!-- Detail Modal -->
  <div id="detailModal" class="hidden fixed inset-0 bg-black/50 z-50 p-4">
    <div class="bg-white w-full max-w-2xl mx-auto mt-[10vh] rounded-2xl p-4">
      <div class="flex items-center justify-between mb-2">
        <div class="text-lg font-semibold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</div>
        <button id="closeDetail" class="px-3 py-1.5 rounded-xl hover:bg-gray-100">‚úï</button>
      </div>
      <div id="detailContent" class="space-y-4"></div>
    </div>
  </div>

  <!-- Create Modal -->
  <div id="createModal" class="hidden fixed inset-0 bg-black/50 z-50 p-4">
    <div class="bg-white w-full max-w-lg mx-auto mt-[10vh] rounded-2xl p-4">
      <div class="flex items-center justify-between mb-2">
        <div class="text-lg font-semibold">‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</div>
        <button id="closeCreate" class="px-3 py-1.5 rounded-xl hover:bg-gray-100">‚úï</button>
      </div>
      <div class="space-y-3">
        <div>
          <label class="text-sm">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</label>
          <select id="createPlace" class="w-full border rounded-md p-2 mt-1"></select>
        </div>
        <div>
          <label class="text-sm">‡πÉ‡∏´‡πâ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: <span id="createRateLabel">5</span> ‡∏î‡∏≤‡∏ß</label>
          <input id="createRate" type="range" min="1" max="5" step="1" value="5" class="w-full accent-blue-600" />
        </div>
        <div>
          <label class="text-sm">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</label>
          <textarea id="createText" rows="4" class="w-full border rounded-xl px-3 py-2 outline-none focus:ring-2 focus:ring-blue-500" placeholder="‡πÄ‡∏•‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì"></textarea>
        </div>
        <div id="verifyHint" class="text-sm text-gray-500">* ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Verified</div>
        <div class="flex items-center justify-end gap-2">
          <button id="cancelCreate" class="border rounded-2xl px-4 py-2">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button id="submitCreate" class="bg-blue-600 hover:bg-blue-700 text-white rounded-2xl px-4 py-2">‡πÇ‡∏û‡∏™‡∏ï‡πå</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // -------- Mock Data --------
    const currentUser = { id:"u_me", name:"‡πÅ‡∏ó‡∏°‡∏°‡∏µ‡πà", handle:"@tammy", level:"Explorer", points:820, badges:["Verified Explorer"] };
    const places = [
      { id:"p_khaotao", name:"‡∏≠‡πà‡∏≤‡∏á‡πÄ‡∏Å‡πá‡∏ö‡∏ô‡πâ‡∏≥‡πÄ‡∏Ç‡∏≤‡πÄ‡∏ï‡πà‡∏≤", province:"‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", category:"‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥", lat:12.5032, lng:99.9886, openingHours:"06:00‚Äì18:30", tags:["‡∏ß‡∏¥‡∏ß‡∏™‡∏ß‡∏¢","‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ","‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ï‡∏Å"], rating:4.8, crowd:"‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á", photos:[
        "https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=1200&auto=format&fit=crop"
      ] },
      { id:"p_somewhere_cnx", name:"Somewhere Cafe", province:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", category:"‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà", lat:18.7953, lng:98.9525, openingHours:"09:00‚Äì18:00", tags:["‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡∏ß‡∏¥‡∏ß‡∏î‡∏µ","‡∏Å‡∏≤‡πÅ‡∏ü‡∏´‡∏≠‡∏°","‡∏†‡∏π‡πÄ‡∏Ç‡∏≤"], rating:4.5, crowd:"‡∏ô‡πâ‡∏≠‡∏¢", photos:[
        "https://images.unsplash.com/photo-1498654896293-37aacf113fd9?q=80&w=1200&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?q=80&w=1200&auto=format&fit=crop"
      ] },
      { id:"p_monjam", name:"‡∏°‡πà‡∏≠‡∏ô‡πÅ‡∏à‡πà‡∏°", province:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", category:"‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥", lat:18.9370, lng:98.8590, openingHours:"05:30‚Äì19:00", tags:["‡∏†‡∏π‡πÄ‡∏Ç‡∏≤","‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏¢‡πá‡∏ô","‡∏ß‡∏¥‡∏ß‡∏û‡∏≤‡πÇ‡∏ô‡∏£‡∏≤‡∏°‡∏≤"], rating:4.7, crowd:"‡∏°‡∏≤‡∏Å", photos:[
        "https://images.unsplash.com/photo-1528821154947-1aa3d1b749b3?q=80&w=1200&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1200&auto=format&fit=crop"
      ] },
      { id:"p_doisuthep", name:"‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û", province:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", category:"‡πÅ‡∏•‡∏ô‡∏î‡πå‡∏°‡∏≤‡∏£‡πå‡∏Å", lat:18.8047, lng:98.9215, openingHours:"06:00‚Äì20:00", tags:["‡∏ß‡∏±‡∏î","‡∏à‡∏∏‡∏î‡∏ä‡∏°‡∏ß‡∏¥‡∏ß"], rating:4.6, crowd:"‡∏°‡∏≤‡∏Å", photos:[
        "https://images.unsplash.com/photo-1548013146-72479768bada?q=80&w=1200&auto=format&fit=crop"
      ] },
      { id:"p_bangsaen", name:"‡∏´‡∏≤‡∏î‡∏ö‡∏≤‡∏á‡πÅ‡∏™‡∏ô", province:"‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", category:"‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥", lat:13.2756, lng:100.9255, openingHours:"24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á", tags:["‡∏ó‡∏∞‡πÄ‡∏•","‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß","‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞"], rating:4.1, crowd:"‡∏°‡∏≤‡∏Å", photos:[
        "https://images.unsplash.com/photo-1500375592092-40eb2168fd21?q=80&w=1200&auto=format&fit=crop",
        "https://images.unsplash.com/photo-1469474968028-56623f02e42e?q=80&w=1200&auto=format&fit=crop"
      ] },
    ];
    let reviews = [
      { id:"r1", placeId:"p_khaotao", user:"‡∏ô‡∏ô‡∏ó‡πå", userLevel:"Traveler", rating:5, text:"‡∏ß‡∏¥‡∏ß‡πÄ‡∏¢‡πá‡∏ô‡∏™‡∏ö‡∏≤‡∏¢ ‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ï‡∏Å‡∏™‡∏ß‡∏¢ ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏°‡∏≤‡πÄ‡∏£‡πá‡∏ß", verifiedVisit:true, date:"2025-10-01", likes:22, coverIndex:0, ratio:"4/5" },
      { id:"r2", placeId:"p_somewhere_cnx", user:"‡πÅ‡∏ó‡∏°‡∏°‡∏µ‡πà", userLevel:"Explorer", rating:4, text:"‡∏Å‡∏≤‡πÅ‡∏ü‡∏î‡∏µ ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏´‡∏≠‡∏° ‡∏ö‡∏£‡∏£‡∏¢‡∏≤‡∏Å‡∏≤‡∏®‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏°‡∏≤‡∏Å ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏ö‡πà‡∏≤‡∏¢", verifiedVisit:false, date:"2025-09-20", likes:18, coverIndex:1, ratio:"3/4" },
      { id:"r3", placeId:"p_monjam", user:"‡∏û‡∏µ‡∏ó", userLevel:"Local Expert", rating:5, text:"‡∏•‡∏°‡πÄ‡∏¢‡πá‡∏ô ‡∏ß‡∏¥‡∏ß‡∏™‡∏ß‡∏¢ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞ ‡πÑ‡∏õ‡πÄ‡∏ä‡πâ‡∏≤‡∏î‡∏µ‡∏™‡∏∏‡∏î", verifiedVisit:true, date:"2025-09-12", likes:34, coverIndex:0, ratio:"4/5" },
      { id:"r4", placeId:"p_bangsaen", user:"‡∏ä‡∏¥‡∏ß", userLevel:"Traveler", rating:4, text:"‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞ ‡∏™‡∏ô‡∏∏‡∏Å‡∏Å‡∏±‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡πÅ‡∏ï‡πà‡πÅ‡∏ô‡πà‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î", verifiedVisit:false, date:"2025-08-30", likes:10, coverIndex:0, ratio:"1/1" },
    ];

    // ‡∏Ç‡∏≠‡∏á‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡πÄ‡∏î‡∏¥‡∏°
    const rewardsCatalog = [
      { id:"rw1", name:"‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î Grab 50 ‡∏ö‡∏≤‡∏ó", cost:300, desc:"‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î" },
      { id:"rw2", name:"‡∏Ñ‡∏π‡∏õ‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡∏∑‡πà‡∏°‡∏ü‡∏£‡∏µ (Cafe Partner)", cost:500, desc:"‡∏£‡πâ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏£‡πà‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£" },
      { id:"rw3", name:"‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡∏ú‡πâ‡∏≤ TripMate", cost:800, desc:"‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏ü‡∏£‡∏µ" },
    ];
    // ‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡πÉ‡∏´‡∏°‡πà) ‚Äî ‡∏ã‡∏∑‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞ ‚Äú‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á‚Äù ‡πÅ‡∏•‡∏∞‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏î‡πâ
    const cosmeticsCatalog = [
      // ‡∏ò‡∏µ‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
      { id:"cs_theme_forest", type:"theme", name:"‡∏ò‡∏µ‡∏°‡∏õ‡πà‡∏≤‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß", style:"theme-forest", cost:200, preview:"üåø Forest" },
      { id:"cs_theme_sunset", type:"theme", name:"‡∏ò‡∏µ‡∏°‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå‡∏ï‡∏Å", style:"theme-sunset", cost:200, preview:"üåá Sunset" },
      { id:"cs_theme_night",  type:"theme", name:"‡∏ò‡∏µ‡∏°‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô", style:"theme-night", cost:250, preview:"üåå Night"  },
      // ‡∏Å‡∏£‡∏≠‡∏ö‡∏≠‡∏ß‡∏≤‡∏ï‡∏≤‡∏£‡πå
      { id:"cs_frame_gold", type:"frame", name:"‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏≠‡∏á", style:"frame-gold", cost:180, preview:"ü•á Gold" },
      { id:"cs_frame_neo",  type:"frame", name:"‡∏Å‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πÇ‡∏≠", style:"frame-neo",  cost:150, preview:"üî∑ Neo"  },
      { id:"cs_frame_pastel", type:"frame", name:"‡∏Å‡∏£‡∏≠‡∏ö‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•", style:"frame-pastel", cost:150, preview:"üíú Pastel" },
      // ‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå
      { id:"cs_stk_heart", type:"sticker", name:"‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏´‡∏±‡∏ß‡πÉ‡∏à", style:"‚ù§Ô∏è", cost:80,  preview:"‚ù§Ô∏è" },
      { id:"cs_stk_star",  type:"sticker", name:"‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡∏î‡∏≤‡∏ß",   style:"‚≠ê", cost:80,  preview:"‚≠ê" },
      { id:"cs_stk_cafe",  type:"sticker", name:"‡∏™‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå‡πÅ‡∏Å‡πâ‡∏ß‡∏Å‡∏≤‡πÅ‡∏ü", style:"‚òï", cost:80, preview:"‚òï" },
      // ‡πÅ‡∏ö‡∏î‡∏à‡πå
      { id:"cs_badge_local", type:"badge", name:"Badge: Local Explorer", style:"Local Explorer", cost:120, preview:"üè∑Ô∏è Local" },
      { id:"cs_badge_mvp",   type:"badge", name:"Badge: MVP Reviewer",  style:"MVP Reviewer",   cost:200, preview:"üèÜ MVP" },
    ];

    // -------- State --------
    let TAB="discover", VIEW="vertical"; // vertical | tiles
    let QUERY="", CAT="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", PROV="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î", MAX_KM=80;
    let user = { ...currentUser, points: currentUser.points, badges:[...currentUser.badges] };
    let userLoc = null;

    const $  = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const setHidden = (el,hidden)=> el.classList.toggle("hidden", hidden);
    const kmDist=(a,b,c,d)=>{const R=6371,toRad=x=>x*Math.PI/180;const dLat=toRad(c-a),dLon=toRad(d-b);const A=Math.sin(dLat/2)**2+Math.cos(toRad(a))*Math.cos(toRad(c))*Math.sin(dLon/2)**2;return 2*R*Math.atan2(Math.sqrt(A),Math.sqrt(1-A))};
    const fmtKm=km=>km<1?(km*1000).toFixed(0)+" ‡∏°.":km.toFixed(1)+" ‡∏Å‡∏°.";
    const clip=(s,n)=>s.length>n?s.slice(0,n)+"‚Ä¶":s;

    const latestByPlace=()=>{const sorted=[...reviews].sort((a,b)=>a.date<b.date?1:-1);const m={};for(const r of sorted) if(!m[r.placeId]) m[r.placeId]=r;return m;}
    function filteredPlaces(){
      let arr=places.filter(p=>{
        const q=QUERY.trim().toLowerCase();
        const mq=!q||p.name.toLowerCase().includes(q)||p.tags.join(" ").toLowerCase().includes(q);
        const mc=CAT==="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"||p.category===CAT;
        const mp=PROV==="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î"||p.province===PROV;
        return mq&&mc&&mp;
      });
      if(userLoc){
        arr=arr.map(p=>({p,d:kmDist(userLoc.lat,userLoc.lng,p.lat,p.lng)}))
              .filter(({d})=>d<=MAX_KM)
              .sort((a,b)=>a.d-b.d).map(({p})=>p);
      }else{
        arr=arr.sort((a,b)=>b.rating-a.rating);
      }
      return arr;
    }

    // -------- Discover: Vertical Masonry Cards --------
    function lemonCard(post){
      // ‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á 4:5 / 3:4 / 1:1
      const ratioMap = { "4/5":"pb-[125%]","3/4":"pb-[133%]","1/1":"pb-[100%]" };
      const pb = ratioMap[post.ratio] || "pb-[125%]";
      const p = places.find(x=>x.id===post.placeId);
      const cover = p.photos[post.coverIndex || 0] || p.photos[0];
      return `
        <article class="masonry-item bg-white border rounded-2xl overflow-hidden">
          <div class="relative ${pb}">
            <img src="${cover}" class="absolute inset-0 w-full h-full object-cover"/>
            <div class="absolute left-2 top-2 inline-flex items-center px-2 py-0.5 text-xs rounded-full bg-black/60 text-white">‚≠ê ${post.rating}</div>
            ${post.verifiedVisit?`<div class="absolute right-2 top-2 inline-flex items-center px-2 py-0.5 text-[11px] rounded bg-white/90">‚úîÔ∏é Verified</div>`:""}
            <div class="absolute bottom-0 left-0 right-0 p-3 bg-gradient-to-t from-black/60 to-transparent text-white">
              <div class="font-semibold">${p.name}</div>
              <div class="text-xs opacity-90 line-2">${post.text}</div>
            </div>
          </div>
          <div class="px-3 py-2 flex items-center justify-between text-sm">
            <div class="min-w-0">
              <div class="truncate">${post.user} <span class="text-xs text-gray-500">¬∑ ${post.userLevel||""}</span></div>
              <div class="text-[11px] text-gray-500 truncate">${p.province} ¬∑ ${p.category}</div>
            </div>
            <div class="flex items-center gap-3 text-gray-600">
              <button class="flex items-center gap-1">‚ù§Ô∏è ${post.likes}</button>
              <button class="flex items-center gap-1" data-act="detail" data-id="${p.id}">üìç ‡∏î‡∏π</button>
            </div>
          </div>
        </article>
      `;
    }

    function tileCard(p, r, dist){
      return `
        <div class="bg-white border rounded-2xl overflow-hidden">
          <img src="${p.photos[0]}" class="w-full h-44 object-cover" />
          <div class="p-4 space-y-2">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-lg font-semibold">${p.name}</div>
                <div class="text-sm text-gray-500">${p.province} ¬∑ ${p.category}</div>
              </div>
              <div class="flex items-center gap-2">
                <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-blue-600 text-white">‚≠ê ${p.rating.toFixed(1)}</span>
                ${dist?`<span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs border">üìç ${dist}</span>`:""}
              </div>
            </div>
            ${r?`<div class="bg-gray-50 rounded-xl p-3 text-sm text-gray-700">‚Äú${clip(r.text,140)}‚Äù
              <div class="mt-1 text-[12px] text-gray-500">‚Äî ${r.user} ¬∑ ${r.userLevel||""}</div></div>`:""}
            <div class="flex flex-wrap gap-2">
              ${p.tags.map(t=>`<span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs border">#${t}</span>`).join("")}
            </div>
            <div class="flex items-center justify-between pt-1">
              <div class="text-xs text-gray-500">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£: ${p.openingHours}</div>
              <div class="flex items-center gap-2">
                <button class="border rounded-full px-3 py-1.5 text-sm" data-act="detail" data-id="${p.id}">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                <button class="rounded-full px-3 py-1.5 text-sm bg-blue-600 text-white" data-act="share" data-text="TripMate ¬∑ ${p.name} ¬∑ ${p.province}">‡πÅ‡∏ä‡∏£‡πå</button>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function renderBanners(){
      const banners=[
        {id:"bn1",title:"‡πÇ‡∏ó‡∏ô‡∏≠‡∏∏‡πà‡∏ô Cozy Caf√©",subtitle:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Æ‡∏¥‡∏ï",tag:"#CafeWeek",color:"from-rose-100 to-amber-50",emoji:"‚òï"},
        {id:"bn2",title:"‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏î‡∏µ",subtitle:"‡∏£‡∏ß‡∏°‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ",tag:"#NatureNow",color:"from-emerald-100 to-sky-100",emoji:"üåø"},
        {id:"bn3",title:"#‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏£‡∏≠‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏≤",subtitle:"‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏Ñ‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏¢‡∏≠‡∏∞",tag:"#HiddenGems",color:"from-indigo-100 to-fuchsia-100",emoji:"üìç"},
      ];
      $("#promoBanners").innerHTML=banners.map(b=>`
        <div class="min-w-[280px] rounded-2xl p-4 border bg-gradient-to-br ${b.color}">
          <div class="flex items-start justify-between">
            <div>
              <div class="text-xs text-gray-600">‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</div>
              <div class="font-semibold leading-tight">${b.title}</div>
              <div class="text-[12px] text-gray-600">${b.subtitle}</div>
            </div>
            <div class="text-xl">${b.emoji}</div>
          </div>
          <div class="mt-2">
            <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs border bg-white/60">${b.tag}</span>
          </div>
        </div>
      `).join("");
      $("#topTags").innerHTML=["#‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà‡∏ß‡∏¥‡∏ß‡∏î‡∏µ","#‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥","#‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß","#‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ","#‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏£‡∏≠‡∏á","#‡∏ó‡∏∞‡πÄ‡∏•","#‡∏†‡∏π‡πÄ‡∏Ç‡∏≤"]
        .map(t=>`<button class="inline-flex items-center rounded-full px-3 py-1.5 text-xs border bg-white hover:bg-gray-50 whitespace-nowrap">${t}</button>`).join("");
    }

    function renderDiscover(){
      const posts=[...reviews].map(r=>({ ...r, place: places.find(p=>p.id===r.placeId)})).sort((a,b)=>a.date<b.date?1:-1);
      if(VIEW==="vertical"){
        $("#discoverTiles").classList.add("hidden");
        $("#discoverMasonry").classList.remove("hidden");
        $("#discoverMasonry").innerHTML=posts.map(lemonCard).join("");
      }else{
        $("#discoverMasonry").classList.add("hidden");
        $("#discoverTiles").classList.remove("hidden");
        const map=latestByPlace(); const arr=filteredPlaces();
        $("#discoverTiles").innerHTML=arr.map(p=>{
          const r=map[p.id];
          const dist=userLoc?fmtKm(kmDist(userLoc.lat,userLoc.lng,p.lat,p.lng)):null;
          return tileCard(p,r,dist);
        }).join("");
      }
    }

    // -------- Search --------
    function renderSearchChips(){
      const cats=["‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î","‡∏Ñ‡∏≤‡πÄ‡∏ü‡πà","‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥","‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å","‡∏£‡πâ‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£","‡πÅ‡∏•‡∏ô‡∏î‡πå‡∏°‡∏≤‡∏£‡πå‡∏Å"];
      $("#categoryChips").innerHTML=cats.map(c=>`
        <button class="px-3 py-1.5 rounded-full text-sm ${CAT===c?"bg-blue-600 text-white":"border"}" data-cat="${c}">${c}</button>
      `).join("");
      const provs=["‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î",...Array.from(new Set(places.map(p=>p.province)))];
      $("#provinceChips").innerHTML=provs.map(p=>`
        <button class="px-3 py-1.5 rounded-full text-sm ${PROV===p?"bg-blue-600 text-white":"border"}" data-prov="${p}">${p}</button>
      `).join("");
    }

    function renderSearchResults(){
      const arr=filteredPlaces(); const map=latestByPlace();
      $("#searchResults").innerHTML=arr.length?arr.map(p=>{
        const r=map[p.id];
        const dist=userLoc?fmtKm(kmDist(userLoc.lat,userLoc.lng,p.lat,p.lng)):null;
        return tileCard(p,r,dist);
      }).join(""):`<p class="text-sm text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ï‡∏≤‡∏°‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</p>`;
    }

    // -------- Groups (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡∏¢‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢) --------
    function renderGroups(){
      const c=$("#groupContainer");
      if(c.getAttribute("data-group")==="1"){
        drawGroup(JSON.parse(c.dataset.gdata));
        return;
      }
      c.innerHTML=`
        <div class="bg-white border rounded-2xl p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="text-lg font-semibold">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÑ‡∏õ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß</div>
            <button id="createGroupBtn" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1.5">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
          </div>
          <p class="text-sm text-gray-600">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô ‡πÄ‡∏™‡∏ô‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß ‡πÇ‡∏´‡∏ß‡∏ï ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î "‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏£‡∏¥‡∏õ" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß</p>
        </div>
        <div id="groupArea" class="mt-3"></div>
      `;
      c.setAttribute("data-group","1");
      $("#createGroupBtn").onclick=()=>{
        const g={id:"g_"+Date.now(), name:"‡∏ó‡∏£‡∏¥‡∏õ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏õ‡∏µ‡πÉ‡∏´‡∏°‡πà 2025", members:["‡πÅ‡∏ó‡∏°‡∏°‡∏µ‡πà","‡∏ô‡∏ô‡∏ó‡πå","‡∏û‡∏µ‡∏ó","‡∏ä‡∏¥‡∏ß"], date:"2025-12-30", province:"‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", proposals:["p_monjam","p_somewhere_cnx","p_doisuthep"], votes:{}, confirmedPlaceIds:null};
        c.dataset.gdata=JSON.stringify(g);
        drawGroup(g);
      };
    }

    function drawGroup(g){
      const area=$("#groupArea");
      area.innerHTML=`
        <div class="bg-white border rounded-2xl p-4 flex items-center justify-between">
          <div>
            <div class="text-lg font-semibold">${g.name}</div>
            <div class="text-sm text-gray-500">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${g.members.join(", ")}</div>
          </div>
          <button class="border rounded-full px-3 py-1.5" onclick="navigator.clipboard.writeText('‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏•‡∏∏‡πà‡∏°: ${g.name}')">‡πÅ‡∏ä‡∏£‡πå</button>
        </div>
        <div class="bg-white border rounded-2xl p-4 mt-3">
          <div class="font-semibold mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏ß‡∏ï</div>
          ${g.proposals.map(pid=>{
            const p=places.find(x=>x.id===pid);
            const counts=Object.values(g.votes).filter(v=>v===pid).length;
            const voted=g.votes[currentUser.name]===pid;
            return `
              <div class="flex items-center justify-between border rounded-xl p-3 mb-2 ${voted?'border-blue-500':''}">
                <div>
                  <div class="font-medium">${p.name}</div>
                  <div class="text-xs text-gray-500">${p.province} ¬∑ ‚≠ê ${p.rating.toFixed(1)}</div>
                </div>
                <div class="flex items-center gap-3">
                  <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-gray-100">‡πÇ‡∏´‡∏ß‡∏ï: ${counts}</span>
                  <button class="px-3 py-1.5 rounded-full ${voted?'bg-blue-600 text-white':'border'}" data-vote="${pid}">${voted?'‡πÇ‡∏´‡∏ß‡∏ï‡πÅ‡∏•‡πâ‡∏ß':'‡πÇ‡∏´‡∏ß‡∏ï'}</button>
                </div>
              </div>
            `;
          }).join("")}
          <div class="flex items-center justify-between pt-2">
            <div class="text-sm text-gray-500">‡∏Å‡∏î‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á Trip Plan (One-click)</div>
            <button id="confirmTripBtn" class="bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1.5">üó∫Ô∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏£‡∏¥‡∏õ</button>
          </div>
        </div>
        <div id="tripSummary"></div>
      `;
      area.querySelectorAll("[data-vote]").forEach(btn=>{
        btn.addEventListener("click",()=>{ g.votes[currentUser.name]=btn.getAttribute("data-vote"); document.querySelector("#groupContainer").dataset.gdata=JSON.stringify(g); drawGroup(g); });
      });
      $("#confirmTripBtn").onclick=()=>{
        const counts={}; g.proposals.forEach(pid=>counts[pid]=0);
        Object.values(g.votes).forEach(pid=>counts[pid]=(counts[pid]||0)+1);
        const top=Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,2).map(([pid])=>pid);
        g.confirmedPlaceIds=top;
        document.querySelector("#groupContainer").dataset.gdata=JSON.stringify(g);
        drawTripSummary(top);
        alert("‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏£‡∏¥‡∏õ‡πÅ‡∏•‡πâ‡∏ß: ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏î‡∏µ‡∏¢‡∏ß");
      };
    }
    function drawTripSummary(ids){
      const cont=$("#tripSummary");
      const map=latestByPlace();
      cont.innerHTML=`
        <div class="bg-white border rounded-2xl p-4 mt-3">
          <div class="font-semibold mb-2">‡∏™‡∏£‡∏∏‡∏õ‡∏ó‡∏£‡∏¥‡∏õ (One-click Plan)</div>
          ${ids.map(pid=>{
            const p=places.find(x=>x.id===pid);
            const r=map[pid];
            return `
              <div class="border rounded-2xl p-3 mb-2">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-medium">${p.name}</div>
                    <div class="text-xs text-gray-500">${p.province} ¬∑ ${p.category}</div>
                  </div>
                  <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-blue-600 text-white">‚≠ê ${p.rating.toFixed(1)}</span>
                </div>
                ${r?`<div class="text-sm text-gray-600 mt-1">‚Äú${clip(r.text,120)}‚Äù ‚Äî ${r.user}</div>`:""}
                <div class="mt-2"><button class="border rounded-full px-3 py-1.5 text-sm" data-act="detail" data-id="${p.id}">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button></div>
              </div>
            `;
          }).join("")}
          <div class="flex items-center justify-end">
            <button class="border rounded-full px-3 py-1.5" onclick="navigator.clipboard.writeText('Trip Plan ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏ä‡∏£‡πå')">‡πÅ‡∏ä‡∏£‡πå‡πÅ‡∏ú‡∏ô</button>
          </div>
        </div>
      `;
    }

    // -------- Rewards & Cosmetics --------
    function renderRewards(){
      $("#pointsEl").textContent=user.points+" pts";
      $("#badgesEl").textContent="‡πÅ‡∏ö‡∏î‡∏à‡πå: "+(user.badges.join(", ")||"-");

      $("#rewardsList").innerHTML=rewardsCatalog.map(rw=>`
        <div class="bg-white border rounded-2xl p-4 flex items-center justify-between">
          <div>
            <div class="font-semibold">${rw.name}</div>
            <div class="text-sm text-gray-500">${rw.desc}</div>
          </div>
          <div class="flex items-center gap-3">
            <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-gray-100">${rw.cost} pts</span>
            <button class="bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1.5" data-redeem="${rw.id}">‡πÅ‡∏•‡∏Å</button>
          </div>
        </div>
      `).join("");

      $("#cosmeticsList").innerHTML=cosmeticsCatalog.map(c=>`
        <div class="bg-white border rounded-2xl p-4 flex items-center justify-between">
          <div>
            <div class="font-semibold">${c.name}</div>
            <div class="text-sm text-gray-500">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${c.type}</div>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-sm">${c.preview}</span>
            <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-gray-100">${c.cost} pts</span>
            <button class="border rounded-full px-3 py-1.5 text-sm" data-buy="${c.id}">‡∏ã‡∏∑‡πâ‡∏≠</button>
          </div>
        </div>
      `).join("");

      // ‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡∏Å/‡∏ã‡∏∑‡πâ‡∏≠
      $("#rewardsList").querySelectorAll("[data-redeem]").forEach(btn=>{
        btn.addEventListener("click",()=>{
          const rw=rewardsCatalog.find(r=>r.id===btn.getAttribute("data-redeem"));
          if(user.points<rw.cost){ alert("‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠‡πÅ‡∏•‡∏Å");return; }
          user.points-=rw.cost; renderRewards(); renderProfileHeader();
          alert(`‡πÅ‡∏•‡∏Å "${rw.name}" ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à (mock)`);
        });
      });
      $("#cosmeticsList").querySelectorAll("[data-buy]").forEach(btn=>{
        btn.addEventListener("click",()=>{
          const cs=cosmeticsCatalog.find(x=>x.id===btn.getAttribute("data-buy"));
          if(user.points<cs.cost){ alert("‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á");return; }
          user.points-=cs.cost;
          // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏ß‡πâ‡πÉ‡∏ô local owned
          const owned = JSON.parse(localStorage.getItem("ownedCosmetics")||"[]");
          if(!owned.includes(cs.id)) owned.push(cs.id);
          localStorage.setItem("ownedCosmetics", JSON.stringify(owned));
          renderRewards(); renderOwnedCosmetics();
          alert(`‡∏ã‡∏∑‡πâ‡∏≠ ${cs.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô`);
        });
      });
    }

    function renderOwnedCosmetics(){
      const owned = JSON.parse(localStorage.getItem("ownedCosmetics")||"[]");
      $("#ownedCosmetics").innerHTML = owned.length? owned.map(id=>{
        const cs = cosmeticsCatalog.find(x=>x.id===id);
        return `
          <div class="border rounded-xl p-3 flex items-center justify-between">
            <div class="min-w-0">
              <div class="font-medium truncate">${cs.name}</div>
              <div class="text-xs text-gray-500 truncate">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${cs.type}</div>
            </div>
            <button class="bg-blue-600 hover:bg-blue-700 text-white rounded-full px-3 py-1.5 text-sm" data-apply="${cs.id}">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
          </div>
        `;
      }).join("") : `<p class="text-sm text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á</p>`;

      $("#ownedCosmetics").querySelectorAll("[data-apply]").forEach(btn=>{
        btn.addEventListener("click",()=>applyCosmetic(btn.getAttribute("data-apply")));
      });
    }

    // ‡πÉ‡∏ä‡πâ‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏±‡∏ö‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
    function applyCosmetic(id){
      const cs = cosmeticsCatalog.find(x=>x.id===id);
      if(!cs) return;
      if(cs.type==="theme"){
        const el = $("#profileTheme");
        el.classList.remove("theme-basic","theme-forest","theme-sunset","theme-night");
        el.classList.add(cs.style);
      } else if(cs.type==="frame"){
        const wrap=$("#avatarWrap");
        wrap.className = "w-16 h-16 overflow-hidden grid place-items-center " + cs.style;
        wrap.style.background="#fff";
      } else if(cs.type==="sticker"){
        const holder = $("#profileStickers");
        const span = document.createElement("span");
        span.className="sticker text-4xl left-6 -top-8";
        span.textContent = cs.style;
        holder.appendChild(span);
        holder.style.height="24px";
      } else if(cs.type==="badge"){
        if(!user.badges.includes(cs.style)) user.badges.push(cs.style);
        renderProfileHeader();
      }
      alert("‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß");
    }

    // -------- Profile --------
    function renderProfileHeader(){
      $("#userNameEl").textContent=user.name;
      $("#userHandleEl").textContent=user.handle;
      $("#userMetaEl").textContent=`‡∏£‡∏∞‡∏î‡∏±‡∏ö: ${user.level} ¬∑ ‡πÅ‡∏ï‡πâ‡∏°: ${user.points} ¬∑ ‡πÅ‡∏ö‡∏î‡∏à‡πå: ${user.badges.join(", ")||"-"}`;
      const my=reviews.filter(r=>r.user===user.name);
      $("#myReviews").innerHTML=my.length?my.map(r=>{
        const p=places.find(x=>x.id===r.placeId);
        return `
          <div class="bg-white border rounded-2xl p-3">
            <div class="flex items-center justify-between">
              <div class="font-medium">${p.name}</div>
              <div class="text-amber-600">‚≠ê ${r.rating}</div>
            </div>
            <p class="text-sm mt-1">${r.text}</p>
            ${r.verifiedVisit?`<div class="mt-2"><span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-gray-100">‚úîÔ∏é Verified Visitor</span></div>`:""}
          </div>
        `;
      }).join(""):`<p class="text-sm text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>`;
    }

    // -------- Detail --------
    function renderDetail(place){
      const placeReviews=reviews.filter(r=>r.placeId===place.id).sort((a,b)=>a.date<b.date?1:-1);
      const autoNearby=places.filter(p=>p.id!==place.id).map(p=>({p,d:kmDist(place.lat,place.lng,p.lat,p.lng)}))
        .filter(({d})=>d<=10).sort((a,b)=>a.d-b.d).map(({p})=>p);
      $("#detailContent").innerHTML=`
        <header class="space-y-1">
          <div class="text-xl font-semibold">${place.name}</div>
          <div class="text-sm text-gray-500">${place.province} ¬∑ ${place.category}</div>
          <div class="flex items-center gap-2 mt-1">
            <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-blue-600 text-white">‚≠ê ${place.rating.toFixed(1)}</span>
            <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-gray-100">Crowd: ${place.crowd}</span>
            <span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs border">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏≥‡∏Å‡∏≤‡∏£: ${place.openingHours}</span>
          </div>
        </header>

        <section>
          <div class="font-semibold mb-2">‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
          <div class="space-y-2">
            ${placeReviews.length?placeReviews.map(r=>`
              <div class="border rounded-xl p-3">
                <div class="flex items-center justify-between">
                  <div class="font-medium">${r.user} <span class="text-xs text-gray-500">¬∑ ${r.userLevel||""}</span></div>
                  <div class="text-amber-600">‚≠ê ${r.rating}</div>
                </div>
                <p class="text-sm mt-1">${r.text}</p>
                ${r.verifiedVisit?`<div class="mt-2"><span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-gray-100">‚úîÔ∏é Verified Visitor</span></div>`:""}
              </div>
            `).join(""):`<p class="text-sm text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏µ‡∏ß‡∏¥‡∏ß</p>`}
          </div>
        </section>

        <section>
          <div class="font-semibold mb-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á (‚â§10 ‡∏Å‡∏°.)</div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            ${autoNearby.length?autoNearby.map(np=>`
              <div class="border rounded-xl p-3 flex items-center justify-between">
                <div>
                  <div class="font-medium">${np.name}</div>
                  <div class="text-xs text-gray-500">${np.category} ¬∑ ‚≠ê ${np.rating.toFixed(1)}</div>
                </div>
                <button class="px-3 py-1.5 rounded-full border" data-act="detail" data-id="${np.id}">‡∏î‡∏π</button>
              </div>
            `).join(""):`<p class="text-sm text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ô‡∏£‡∏±‡∏®‡∏°‡∏µ‡∏ô‡∏µ‡πâ</p>`}
          </div>
        </section>

        <div class="flex items-center justify-end gap-2">
          <button class="px-3 py-1.5 rounded-full border" onclick="navigator.clipboard.writeText('Trip: ${place.name}')">‡πÅ‡∏ä‡∏£‡πå</button>
        </div>
      `;
    }

    // -------- Events & Init --------
    const openDetail = (place)=>{ renderDetail(place); setHidden($("#detailModal"), false); };
    const closeDetail = ()=> setHidden($("#detailModal"), true);
    $("#closeDetail").onclick=closeDetail;

    // Bottom nav
    $$(".grid [data-tab]").forEach(btn=>{
      btn.onclick=()=>{ TAB=btn.dataset.tab;
        ["discover","search","groups","rewards","profile"].forEach(id=>setHidden($("#page-"+id), id!==TAB));
        btn.parentElement.querySelectorAll("button").forEach(b=>{
          b.classList.toggle("text-blue-600", b===btn);
          b.classList.toggle("text-gray-600", b!==btn);
        });
        if(TAB==="discover") renderDiscover();
        if(TAB==="search")   { renderSearchChips(); renderSearchResults(); }
        if(TAB==="groups")   renderGroups();
        if(TAB==="rewards")  renderRewards();
        if(TAB==="profile")  { renderProfileHeader(); renderOwnedCosmetics(); }
      };
    });

    // toggle view
    $("#toggleView").onclick=()=>{
      VIEW = VIEW==="vertical" ? "tiles" : "vertical";
      $("#toggleView").textContent = "‡πÇ‡∏´‡∏°‡∏î: " + (VIEW==="vertical"?"‡∏†‡∏≤‡∏û‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á":"‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà");
      renderDiscover();
    };

    // share / detail (delegate)
    document.body.addEventListener("click",(e)=>{
      const t=e.target.closest("[data-act]");
      if(!t) return;
      const act=t.getAttribute("data-act");
      if(act==="detail"){
        const id=t.getAttribute("data-id");
        openDetail(places.find(x=>x.id===id));
      } else if(act==="share"){
        const text=t.getAttribute("data-text")||"TripMate";
        if(navigator.share) navigator.share({title:"TripMate", text}); else { navigator.clipboard.writeText(text); alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß"); }
      }
    });

    // Create post modal
    const setHiddenEl=(id,val)=> setHidden($(id), val);
    $("#openCreatePost").onclick=()=>{ openCreate(); };
    $("#fabCreate").onclick=()=>{ openCreate(); };
    function openCreate(){ populateCreatePlaces(); updateVerifyHint(); setHiddenEl("#createModal", false); }
    function closeCreate(){ setHiddenEl("#createModal", true); }
    $("#closeCreate").onclick=closeCreate;
    $("#cancelCreate").onclick=closeCreate;
    $("#createPlace").addEventListener("change", updateVerifyHint);
    $("#createRate").addEventListener("input",(e)=>$("#createRateLabel").textContent=e.target.value);
    $("#submitCreate").onclick=()=>{
      const placeId=$("#createPlace").value;
      const rating=Number($("#createRate").value);
      const text=$("#createText").value||"‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏£‡∏±‡∏ö/‡∏Ñ‡πà‡∏∞";
      const p=places.find(x=>x.id===placeId);
      const verified=userLoc?kmDist(userLoc.lat,userLoc.lng,p.lat,p.lng)<=1:false;
      const newReview={id:"r_"+Date.now(), placeId, user:user.name, userLevel:user.level, rating, text, verifiedVisit:verified, date:new Date().toISOString().slice(0,10), likes:0, coverIndex:0, ratio:"4/5"};
      reviews=[newReview,...reviews];
      user.points+=10+(verified?5:0);
      if(verified && !user.badges.includes("Verified Explorer")) user.badges.push("Verified Explorer");
      alert(`‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πâ‡∏° ${10+(verified?5:0)}`);
      renderDiscover(); renderRewards(); renderProfileHeader(); closeCreate();
    };
    function populateCreatePlaces(){ $("#createPlace").innerHTML=places.map(p=>`<option value="${p.id}">${p.name} ¬∑ ${p.province}</option>`).join(""); }
    function updateVerifyHint(){
      const pid=$("#createPlace").value||places[0].id;
      const p=places.find(x=>x.id===pid);
      const verified=userLoc?kmDist(userLoc.lat,userLoc.lng,p.lat,p.lng)<=1:false;
      $("#verifyHint").innerHTML=verified?
        `<span class="inline-flex items-center rounded-full px-2.5 py-1 text-xs bg-gray-100">‚úîÔ∏é Verified Visitor (GPS)</span>`:
        `* ‡πÄ‡∏õ‡∏¥‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Verified`;
    }

    // top search ‚Üí ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ search
    $("#topSearch").addEventListener("keydown",(e)=>{ if(e.key==="Enter"){ TAB="search"; ["discover","search","groups","rewards","profile"].forEach(id=>setHidden($("#page-"+id), id!==TAB)); $("#searchInput").value=e.target.value; QUERY=e.target.value; renderSearchChips(); renderSearchResults(); }});
    $("#applySearchBtn").onclick=()=>{ QUERY=$("#searchInput").value||""; renderSearchResults(); };
    $("#distSlider").addEventListener("input",(e)=>{ MAX_KM=Number(e.target.value); $("#distVal").textContent=MAX_KM; renderSearchResults(); });
    $("#categoryChips").addEventListener("click",(e)=>{ const b=e.target.closest("[data-cat]"); if(!b) return; CAT=b.getAttribute("data-cat"); renderSearchChips(); renderSearchResults(); });
    $("#provinceChips").addEventListener("click",(e)=>{ const b=e.target.closest("[data-prov]"); if(!b) return; PROV=b.getAttribute("data-prov"); renderSearchChips(); renderSearchResults(); });

    // geolocation
    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition((pos)=>{
        userLoc={lat:pos.coords.latitude,lng:pos.coords.longitude};
        $("#locInfo").textContent="‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡∏∏‡∏ì";
        renderDiscover(); renderSearchResults(); updateVerifyHint();
      }, ()=>{
        $("#locInfo").textContent="‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏ô‡∏¥‡∏¢‡∏°‡πÅ‡∏ó‡∏ô";
      }, {enableHighAccuracy:true, timeout:7000});
    } else {
      $("#locInfo").textContent="‡πÇ‡∏´‡∏°‡∏î‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á";
    }

    // init
    renderBanners(); renderDiscover(); renderSearchChips(); renderSearchResults(); renderGroups(); renderRewards(); renderProfileHeader(); renderOwnedCosmetics();
  </script>
</body>
</html>
